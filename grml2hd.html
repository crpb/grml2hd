<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 7.1.2" />
<style type="text/css">
/* Debug borders */
p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 {
/*
  border: 1px solid red;
*/
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
}

strong {
  font-weight: bold;
}

tt {
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  font-family: sans-serif;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1 {
  border-bottom: 2px solid silver;
}
h2 {
  border-bottom: 2px solid silver;
  padding-top: 0.5em;
}

div.sectionbody {
  font-family: serif;
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  font-size: 1.2em;
}
span#email {
}
span#revision {
  font-family: sans-serif;
}

div#footer {
  font-family: sans-serif;
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble,
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-right: 10%;
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.5em;
  margin-bottom: 2.5em;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  font-family: sans-serif;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock > div.content {
  padding-left: 2.0em;
}

div.attribution {
  text-align: right;
}
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 2px solid silver;
}

div.exampleblock > div.content {
  border-left: 2px solid silver;
  padding: 0.5em;
}

div.verseblock div.content {
  white-space: pre;
}

div.imageblock div.content { padding-left: 0; }
div.imageblock img { border: 1px solid silver; }
span.image img { border-style: none; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: italic;
}
dd > *:first-child {
  margin-top: 0;
}

ul, ol {
    list-style-position: outside;
}
ol.olist2 {
  list-style-type: lower-alpha;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead {
  font-family: sans-serif;
  font-weight: bold;
}
tfoot {
  font-weight: bold;
}

div.hlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
td.hlist1 {
  vertical-align: top;
  font-style: italic;
  padding-right: 0.8em;
}
td.hlist2 {
  vertical-align: top;
}

@media print {
  div#footer-badges { display: none; }
}
/* Workarounds for IE6's broken and incomplete CSS2. */

div.sidebar-content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}
div.sidebar-title, div.image-title {
  font-family: sans-serif;
  font-weight: bold;
  margin-top: 0.0em;
  margin-bottom: 0.5em;
}

div.listingblock div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock-content {
  padding-left: 2.0em;
}

div.exampleblock-content {
  border-left: 2px solid silver;
  padding-left: 0.5em;
}
</style>
<title>grml2hd(8)</title>
</head>
<body>
<div id="header">
<h1>grml2hd(8)</h1>
</div>
<h2>Name</h2>
<div class="sectionbody">
<p>grml2hd - install grml on harddisk</p>
</div>
<h2>Synopsis</h2>
<div class="sectionbody">
<p>grml2hd [ partition ] [ options ]</p>
<div class="sidebarblock">
<div class="sidebar-content">
<p>Important! The grml team does not take responsibility for loss of any data!</p>
</div></div>
</div>
<h2>Options and environment variables</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre><tt>-v</tt></pre>
</div></div>
<p>Return version and exit.</p>
<div class="literalblock">
<div class="content">
<pre><tt>GRML2HD_NONINTERACTIVE=1 grml2hd ....</tt></pre>
</div></div>
<p>Install grml2hd in non-interactive mode (using /etc/grml2hd/config).</p>
<div class="literalblock">
<div class="content">
<pre><tt>NOSWREMOVAL=1 grml2hd ...</tt></pre>
</div></div>
<p>Disable running script remove-packages-server for removing some
special software packages.</p>
<div class="literalblock">
<div class="content">
<pre><tt>SWRAID='mbr-only' grml2hd /dev/md0 -mbr /dev/md0</tt></pre>
</div></div>
<p>Install grml on raid array /dev/md0 and install mbr as well.</p>
</div>
<h2>Introduction</h2>
<div class="sectionbody">
<p>grml2hd installs grml on a partition on your harddisk and makes it
bootable. The partition is formatted with mkfs (using the selected
filesystem), then all necessary files are copied. Then you have to answer a
few questions like username, passwords and which features you want to use
on your harddisk installation.  To boot the new installation lilo is
installed in the boot-sector of the partition or in the MBR, depending
on your selection.</p>
</div>
<h2>Automatic installation</h2>
<div class="sectionbody">
<p>It is possible to run grml2hd in a non-interactive mode where no further
manual input is required. This mode is useful if you do not want to sit in
front of your computer during installation or if you want to set up a
cluster of computers (e.g. a computer lab). There are two possibilities to
run grml2hd in automatic mode.  But: Do <strong>not</strong> use the grml2hd
non-interactive mode if you do not know what you are doing!</p>
<h3>Automatic installation trough running grml system</h3>
<p>Configuration of the automatic installation is done via the configuration file
/etc/grml2hd/config. To activate automatic mode you have to set the environment
variable GRML2HD_NONINTERACTIVE or use the <em>-i</em> option on the commandline.
Use the automatic installation mode with care as you won't be prompted
for any more questions!</p>
<h3>Automatic installation through booting grml</h3>
<p>You can install grml without even booting it before. If you do not know
your system very well we recommend booting grml before running grml2hd. If
everything works as intented and you want to install grml on many computers
at the same time you can do this via entering only some few words on the
bootprompt or use grml2hd via
<a href="http://grml.org/terminalserver/">grml-terminalserver</a>.</p>
<p>Configuration is done via boot options:</p>
<div class="literalblock">
<div class="content">
<pre><tt>user=                                            =&gt; user name for user which should be used at hd-install (default: grml)
filesystem={ext2|ext3|reiserfs|reiser4|jfs|xfs}  =&gt; filesystem to be used (default: ext3)
mbr=/dev/...                                     =&gt; partition where MBR should be installed (default:=partition)
partition=/dev/...                               =&gt; partition where grml should be installed (must be set - no default!)</tt></pre>
</div></div>
<p>Usage example for booting and installing grml on partition /dev/hda4:</p>
<div class="literalblock">
<div class="content">
<pre><tt>grml2hd partion=/dev/hda4 mbr=/dev/hda filesystem=ext3 user=mika</tt></pre>
</div></div>
<p>Passwords of user root and user are "grml" - please adjust after harddisk
installation!</p>
<div class="sidebarblock">
<div class="sidebar-content">
<p>Important: not all filesystems are supported in grml-small. ext3 is the
default and recommended.  Do <strong>not</strong> use the grml2hd bootoption if you do not
know what you are doing!</p>
</div></div>
</div>
<h2>grml2hd with software RAID</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre><tt>mdadm --create --verbose /dev/md0 --level=raid1 --raid-devices=2 /dev/hda1 /dev/hdc1</tt></pre>
</div></div>
<p>Prepare RAID setup with mdadm.</p>
<div class="literalblock">
<div class="content">
<pre><tt>SWRAID='mbr-only' grml2hd</tt></pre>
</div></div>
<p>Install grml on raid array /dev/md0 and install mbr as well.  The SWRAID
environment variable provides the option for the raid-extra-boot option in
/etc/lilo.conf. Please notice that the driver(s) for the devices used in a
raid array have to be statically compiled into the kernel, otherwise
automatic assembling won't work and assembling has to be done in userland
(won't work for SW-RAID on root partitions then of course).</p>
</div>
<h2>grml2hd with encrypted partitions.</h2>
<div class="sectionbody">
<p>Installing grml on an encrypted root-partition ('/') is <strong>not</strong> supported.
But you can use encrypted partitions like /home or swap. Install grml2hd as
usual, (re)boot into your grml system and then activate encrypted
partitions manually.</p>
<h3>encrypted swap partition</h3>
<p>Deactivate swap partition:</p>
<div class="literalblock">
<div class="content">
<pre><tt># swapoff -a</tt></pre>
</div></div>
<p>Now adjust /etc/crypttab</p>
<div class="literalblock">
<div class="content">
<pre><tt># echo "cswap   /dev/hda5       /dev/urandom    swap" &gt;&gt; /etc/crypttab</tt></pre>
</div></div>
<p>Now delete the old swap-entry in /etc/fstab and add the following line:</p>
<div class="literalblock">
<div class="content">
<pre><tt>/dev/mapper/cswap   none    swap  sw,pri=1        0  0</tt></pre>
</div></div>
<p>Make sure this entry is above(!) the 'Warning! Please do *not* change
any&#8230;' line!  Then enable the encrypted swap partition running:</p>
<div class="literalblock">
<div class="content">
<pre><tt># /etc/init.d/cryptdisks start &amp;&amp; swapon -a</tt></pre>
</div></div>
<h3>encrypted /home partition</h3>
<p>Make sure the device you want to use for your /home-partition is not
mounted. Then initialize the partition you want to use as encrypted /home
using grml-crypt. Important: this will destroy all data on /home!
grml-crypt is a wrapper around cryptsetup-luks, you will be able to use the
partition with every linux distribution which supports cryptsetup-luks.</p>
<p>The following example demonstrates how to use /dev/hda5 as an encrypted
/home partition:</p>
<div class="literalblock">
<div class="content">
<pre><tt># grml-crypt -t ext3 -o format /dev/hda5</tt></pre>
</div></div>
<p>Now adjust /etc/crypttab</p>
<div class="literalblock">
<div class="content">
<pre><tt># echo "chda5  /dev/hda5  none luks" &gt;&gt;/etc/crypttab</tt></pre>
</div></div>
<p>Then add the /home-partition to /etc/fstab (make sure there is not other
entry for the partition):</p>
<div class="literalblock">
<div class="content">
<pre><tt>/dev/mapper/chda5  /home  ext3  defaults  0 0</tt></pre>
</div></div>
<p>Make sure this entry is above(!) the 'Warning! Please do *not* change
any&#8230;' line! If you want to keep content of your old /home make sure you
can access it later again:</p>
<div class="literalblock">
<div class="content">
<pre><tt># mv /home /home.old
# mkdir -m 755 /home</tt></pre>
</div></div>
<p>To make sure that /home is not accessible before mounted as crypto
partition you can use chattr:</p>
<div class="literalblock">
<div class="content">
<pre><tt># chattr +i /home</tt></pre>
</div></div>
<p>Now start cryptdisks and mount your new /home-partition:</p>
<div class="literalblock">
<div class="content">
<pre><tt># /etc/init.d/cryptdisks start &amp;&amp; mount /home</tt></pre>
</div></div>
<p>Please make sure cryptdisks is started in runlevel 2 via
/etc/runlevel.conf!</p>
<p>If you moved your old /home to /home.old copy files to your new
/home-partition:</p>
<div class="literalblock">
<div class="content">
<pre><tt># cp -a /home.old/* /home/</tt></pre>
</div></div>
<p>If everything works as expected you will be prompted for the given LUKS
passphrase when booting your grml system.</p>
</div>
<h2>Files</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre><tt>/etc/grml2hd/config</tt></pre>
</div></div>
<p>Configuration file for automatic installation via grml2hd. You do not
need to adjust this file if you do not want to run the automatic installation.</p>
<div class="literalblock">
<div class="content">
<pre><tt>/usr/sbin/grml2hd-chrooted</tt></pre>
</div></div>
<p>A small helper script, that executes a few commands in the harddisk
installation. You'll never need this script, it's only useful for the
grml2hd script.</p>
<div class="literalblock">
<div class="content">
<pre><tt>/usr/bin/grml2hd-bootparams</tt></pre>
</div></div>
<p>A small helper script that reads kernel's command line and displays a menu
of boot parameters which should be used for lilo's append line.  The script
provides the selected entries on stdout so it's possible to use the script
inside grml2hd itself.</p>
<div class="literalblock">
<div class="content">
<pre><tt>/boot/grub/grml-template_menu.lst</tt></pre>
</div></div>
<p>Template file for use with grml installation (grml2hd) and Grub.
Adjust it for your needs before using it.</p>
</div>
<h2>FAQ</h2>
<div class="sectionbody">
<h3>Why is $FEATURE not available in grml2hd?</h3>
<p>Because one major goal of grml2hd is keep it small, simple and stable.  If
you think that you can not live without $FEATURE please let us know, see
<a href="#X7">the <em>Bugs</em> section in this document</a> how to report feedback/bugs.</p>
<h3>Why is SW-RAID and/or encrypted partition not available through an interface?</h3>
<p>If you are using such a feature you should know how to handle it. It won't
help you if you get an interface within the installer but do not know
how to handle it afterwards.</p>
<h3>Why is lilo the bootmanager?</h3>
<p>Because it works.</p>
<h3>Can I get grub?</h3>
<p>Yes, not (yet) via grml2hd but via installing it manually. Instructions:
After installing grml via grml2hd adjust grub's configuration file menu.lst:</p>
<div class="literalblock">
<div class="content">
<pre><tt>$EDITOR /boot/grub/menu.lst</tt></pre>
</div></div>
<p>Then install grub (usage example for /dev/sda1):</p>
<div class="literalblock">
<div class="content">
<pre><tt># grub install
root (hd0,0)
setup (hd0)</tt></pre>
</div></div>
</div>
<h2>Known issues</h2>
<div class="sectionbody">
<h3>I can't boot my grml system because Lilo says LI L99 99 99&#8230;</h3>
<p>You probably did not install lilo to master boot record (MBR) via e.g.
<em>grml2hd /dev/hda1 -mbr /dev/hda</em> and don't have a bootmanager in your MBR.
Solution: Install lilo to MBR. Example:</p>
<div class="literalblock">
<div class="content">
<pre><tt>sudo mount -o rw,dev,suid /mnt/hda1 # mount harddisk
sudo chroot /mnt/hda1 # chroot into the grml-system
vim -X /etc/lilo.conf # adjust the line containing the bootoption to 'boot=/dev/hda'
lilo  # now run lilo again, leave chroot environment (exit) and reboot your system afterwards</tt></pre>
</div></div>
<h3>I installed grml on a XFS, JFS or reiser4 filesystem and grml does not boot anymore</h3>
<p>Some filesystems and lilo don't work together when lilo is installed in the
boot sector of the harddisk because the filesystem superblock goes where
lilo would be installed. You have to install lilo in the master boot record
of your harddisk to solve this problem.
If you read this after installing grml to your harddisk you should use the
grml live-cd and fix /etc/lilo.conf manually and rerun lilo (see above).</p>
<h3>I installed grml to an SCSI device and now I can not boot it anymore</h3>
<p>To access an SCSI device you probably need a specific kernel module.  This
is provided by an initial ramdisk. Please use the initrd support within
grml2hd. To fix this issue please install a kernel with SCSI-device support
in the chroot after running grml2hd:</p>
<div class="literalblock">
<div class="content">
<pre><tt>sudo mount -o rw,dev,suid /mnt/hda1 # mount harddisk where grml is installed
sudo chroot /mnt/hda1               # chroot into the grml-system
update-initramfs -u -t -k $(uname -r) # create initramfs
vim -X /etc/lilo.conf               # adjust lilo for use with initrd
lilo  # now run lilo again, leave chroot environment (exit) and reboot your system afterwards</tt></pre>
</div></div>
</div>
<h2>Usage examples</h2>
<div class="sectionbody">
<p>Install grml on /dev/sda4 and install lilo in the mbr of /dev/sda.</p>
<div class="literalblock">
<div class="content">
<pre><tt>GRML2HD_NONINTERACTIVE=1 grml2hd</tt></pre>
</div></div>
<p>Runs grml2hd in automatic (non-interactive) mode. Needs adjustment of
/etc/grml2hd/config. Use with care!</p>
</div>
<h2><a id="X7"></a>Bugs</h2>
<div class="sectionbody">
<p>Please report feedback, <a href="http://grml.org/bugs/">bugreports</a> and wishes <a href="http://grml.org/contact/">to us</a>!</p>
</div>
<h2>Authors</h2>
<div class="sectionbody">
<p>Michael Prokop &lt;mika@grml.org&gt; and Andreas "Jimmy" Gredler &lt;jimmy@grml.org&gt;</p>
</div>
<div id="footer">
<div id="footer-text">
Last updated 20-Oct-2006 00:02:07 CEST
</div>
</div>
</body>
</html>
